<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Spamizard — AI Email Classifier that detects spam & phishing and generates smart replies">
  <title>Spamizard — AI Email Classifier</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #ef4444;          /* red-500 */
      --primary-hover: #dc2626;    /* red-600 */
      --primary-light: #fee2e2;    /* red-100 */
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --bg-light: #ffffff;
      --bg-dark: #111827;
      --card-light: #f9fafb;
      --card-dark: #1f2937;
      --text-light: #111827;
      --text-dark: #f9fafb;
      --border-light: #e5e7eb;
      --border-dark: #374151;
      --input-light: #f3f4f6;
      --input-dark: #374151;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease-in-out;
    }

    body {
      background-color: var(--bg-light);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    .app-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 16px 18px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(248,113,113,0.10), rgba(251,146,60,0.10));
      border: 1px solid rgba(248,113,113,0.25);
      position: relative; /* for ember overlay */
    }

    .title {
      font-size: 28px;
      font-weight: 700;
    }

    /* Branding */
    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .brand-logo {
      width: 72px;
      height: 72px;
      object-fit: contain;
    }

    .brand-title {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .brand-name {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: -0.02em;
    }

    .brand-tagline {
      font-size: 12px;
      line-height: 1.5;
      color: #6b7280;
    }

    body.dark .brand-tagline {
      color: #9ca3af;
    }

    body.dark .header {
      background: linear-gradient(135deg, rgba(248,113,113,0.18), rgba(251,146,60,0.18));
      border-color: rgba(248,113,113,0.35);
    }

    /* Subtle ember animation overlay */
    .header::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      background:
        radial-gradient(120% 120% at 10% 20%, rgba(251,146,60,0.08), transparent 60%),
        radial-gradient(100% 100% at 80% 30%, rgba(239,68,68,0.06), transparent 60%);
      animation: emberPulse 4s ease-in-out infinite alternate;
    }

    @keyframes emberPulse {
      0% { opacity: 0.40; }
      50% { opacity: 0.65; }
      100% { opacity: 0.50; }
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .theme-switch {
      position: relative;
      width: 48px;
      height: 24px;
      background-color: #e5e7eb;
      border-radius: 24px;
      cursor: pointer;
      padding: 2px;
    }

    .theme-switch-inner {
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background-color: white;
      transition: transform 0.2s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    body.dark .theme-switch {
      background-color: var(--primary);
    }

    body.dark .theme-switch-inner {
      transform: translateX(24px);
    }

    .card {
      background-color: var(--card-light);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 30px;
      margin-bottom: 24px;
    }

    body.dark .card {
      background-color: var(--card-dark);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.16);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .text-area {
      width: 100%;
      min-height: 180px;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      background-color: var(--input-light);
      color: var(--text-light);
      font-size: 16px;
      resize: vertical;
      margin-bottom: 20px;
      transition: border-color 0.15s ease-in-out;
    }

    body.dark .text-area {
      border: 1px solid var(--border-dark);
      background-color: var(--input-dark);
      color: var(--text-dark);
    }

    .text-area:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.12);
    }

    .button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.15s ease;
    }

    .button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
    }

    .button:active {
      transform: translateY(0);
    }

    .button:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.28);
    }

    .button-icon {
      font-size: 18px;
    }

    .flash-messages {
      margin-bottom: 20px;
    }

    .flash-message {
      padding: 12px 16px;
      border-radius: 10px;
      background-color: var(--warning);
      color: white;
      font-size: 15px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .result-container {
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .result-card {
      padding: 20px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .result-spam {
      background-color: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .result-safe {
      background-color: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .result-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 20px;
    }

    .result-spam .result-icon {
      background-color: var(--danger);
      color: white;
    }

    .result-safe .result-icon {
      background-color: var(--success);
      color: white;
    }

    .result-content {
      flex: 1;
    }

    .result-title {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 4px;
    }

    .result-description {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 8px;
    }

    body.dark .result-description {
      color: #9ca3af;
    }

    .confidence-meter {
      margin-top: 10px;
      position: relative;
      height: 8px;
      background-color: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
    }

    .confidence-bar {
      height: 100%;
      background-color: var(--success);
      border-radius: 4px;
      width: var(--confidence, 0%);
    }

    .result-spam .confidence-bar {
      background-color: var(--danger);
    }

    .confidence-label {
      font-size: 13px;
      margin-top: 5px;
      display: flex;
      justify-content: space-between;
    }

    .response-card {
      background-color: rgba(16, 185, 129, 0.05);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
    }

    .response-header {
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--success);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .response-content {
      font-size: 15px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .button-wrapper {
      position: relative;
      display: inline-block;
    }

    .button-popover {
      position: absolute;
      bottom: calc(100% + 10px);
      right: 0;
      background: #fff;
      color: #111827;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
      padding: 10px 12px;
      font-size: 13px;
      max-width: 260px;
      display: none;
      z-index: 50;
    }

    .button-popover::after {
      content: '';
      position: absolute;
      top: 100%;
      right: 14px;
      border-width: 6px;
      border-style: solid;
      border-color: #fff transparent transparent transparent;
      filter: drop-shadow(0 -1px 0 rgba(0,0,0,0.05));
    }

    body.dark .button-popover {
      background: var(--card-dark);
      color: var(--text-dark);
      border-color: var(--border-dark);
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }
    body.dark .button-popover::after {
      border-color: var(--card-dark) transparent transparent transparent;
      filter: drop-shadow(0 -1px 0 rgba(0,0,0,0.35));
    }

    .message-counter {
      color: #6b7280;
      font-size: 14px;
    }

    body.dark .message-counter {
      color: #9ca3af;
    }

    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #6b7280;
    }

    body.dark .footer {
      color: #9ca3af;
    }

    .copy-button {
      background-color: transparent;
      border: 1px solid var(--border-light);
      color: #6b7280;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
      transition: all 0.2s ease;
    }

    .copy-button:hover {
      background-color: var(--primary-light);
      color: var(--primary);
      border-color: var(--primary);
    }

    body.dark .copy-button {
      border-color: var(--border-dark);
      color: #9ca3af;
    }

    body.dark .copy-button:hover {
      background-color: rgba(239, 68, 68, 0.1);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* AI reply toggle styles */
    .ai-toggle { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 12px; 
    }
    .ai-toggle .toggle-input {
      position: absolute;
      opacity: 0;
      width: 1px;
      height: 1px;
      pointer-events: none;
    }
    .ai-toggle .toggle-label {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      user-select: none;
    }
    .ai-toggle .toggle-switch {
      position: relative;
      width: 48px;
      height: 24px;
      background-color: #e5e7eb;
      border-radius: 24px;
      padding: 2px;
      transition: background-color 0.2s ease;
    }
    .ai-toggle .toggle-thumb {
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background-color: white;
      transition: transform 0.2s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transform: translateX(0);
      display: block;
    }
    .ai-toggle .toggle-input:checked + .toggle-label .toggle-switch {
      background-color: var(--primary);
    }
    .ai-toggle .toggle-input:checked + .toggle-label .toggle-thumb {
      transform: translateX(24px);
    }
    .ai-toggle .toggle-label:focus-visible .toggle-switch {
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.22);
      outline: none;
    }
    .ai-toggle .toggle-text { font-size: 14px; }
    body.dark .ai-toggle .toggle-switch { background-color: #e5e7eb; }

    @media (max-width: 640px) {
      .app-container {
        padding: 0;
      }
      
      .card {
        padding: 20px;
        border-radius: 12px;
      }
      
      .title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="brand" aria-label="Spamizard brand">
        <!-- Brand logo from assets -->
  <img class="brand-logo" id="brand-logo" src="/assets/charizard.png" alt="Charizard logo" />
        <div class="brand-title">
          <span class="brand-name">Spamizard</span>
          <span class="brand-tagline">Burn spam to ash 🔥</span>
        </div>
      </div>
      <div class="theme-toggle">
        <span id="theme-icon">🌙</span>
        <div id="theme-switch" class="theme-switch" onclick="toggleTheme()" role="switch" aria-checked="false" tabindex="0">
          <div class="theme-switch-inner"></div>
        </div>
      </div>
    </div>
    
    {% if get_flashed_messages() %}
    <div class="flash-messages">
      {% for message in get_flashed_messages() %}
        <div class="flash-message">
          <span>⚠️</span> {{ message }}
        </div>
      {% endfor %}
    </div>
    {% endif %}
    
    <div class="card">
      <h2 class="card-title">
        <span id="card-icon" aria-hidden="true">✉️</span>
        Check your email content
      </h2>
      
      <form method="POST" id="email-form">
        <label for="email-input" class="sr-only">Email content</label>
        <textarea 
          class="text-area" 
          name="email" 
          id="email-input" 
          placeholder="Paste your email content here to check if it's spam..."
          oninput="updateCounter()"
          aria-required="true"
        ></textarea>
        
        <!-- AI response toggle -->
        <div class="ai-toggle">
          <!-- Hidden fallback ensures a value is always posted -->
          <input type="hidden" name="enable_ai" id="enable_ai_hidden" value="{% if enable_ai %}on{% else %}off{% endif %}">

          <!-- Accessible toggle switch -->
          <input type="checkbox" class="toggle-input" id="enable_ai" name="enable_ai" value="on" {% if enable_ai %}checked{% endif %} aria-label="Generate AI reply when not spam">
          <label for="enable_ai" class="toggle-label" tabindex="0" role="switch" aria-checked="{% if enable_ai %}true{% else %}false{% endif %}">
            <span class="toggle-switch"><span class="toggle-thumb"></span></span>
            <span class="toggle-text">Generate AI reply when not spam</span>
          </label>
        </div>
        
        <div class="form-row">
          <div class="message-counter">
            <span id="character-count">0</span> characters
          </div>
          <div class="button-wrapper">
            <button type="submit" class="button" id="analyze-button" aria-disabled="true">
              <span class="button-icon" aria-hidden="true">🔍</span>
              Analyze Email
            </button>
            <div id="button-popover" class="button-popover" role="alert" aria-live="assertive" aria-hidden="true">
              Please enter email content to analyze.
            </div>
          </div>
        </div>
      </form>
    </div>
    
    {% if result is not none %}
    <div class="result-container">
      <div class="result-card {% if result == 'Spam' %}result-spam{% else %}result-safe{% endif %}">
        <div class="result-icon" aria-hidden="true">
          {% if result == 'Spam' %}⚠️{% else %}✓{% endif %}
        </div>
        <div class="result-content">
          <h3 class="result-title">
            {% if result == 'Spam' %}Potential Spam Detected{% else %}Email Appears Safe{% endif %}
          </h3>
          <p class="result-description">
            {% if result == 'Spam' %}
            This email contains characteristics commonly found in spam messages.
            {% else %}
            No spam indicators were found in this email content.
            {% endif %}
          </p>
          
          {% if confidence_score is not none %}
          <div class="confidence-meter" aria-label="Confidence score: {{ confidence_score }}%">
            <div class="confidence-bar" data-confidence="{{ confidence_score }}"></div>
          </div>
          <div class="confidence-label">
            <span>Confidence: {{ confidence_score }}%</span>
            <span>{% if confidence_score > 97 %}100%{% endif %}</span>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
    
    {% if ai_response %}
    <div class="response-card">
      <h3 class="response-header">
        <span aria-hidden="true">💬</span>
        AI Suggested Response
      </h3>
      <div class="response-content">{{ ai_response }}</div>
      <button class="copy-button" onclick="copyResponse()">
        <span>📋</span> Copy to clipboard
      </button>
    </div>
    {% endif %}
  </div>
  
  <div class="footer">
    © 2025 Spamizard • Powered by AI
  </div>

  <script>
    // Theme toggle functionality
    function toggleTheme() {
      const body = document.body;
      const themeIcon = document.getElementById('theme-icon');
      const themeSwitch = document.getElementById('theme-switch');
      
      body.classList.toggle('dark');
      
      const isDark = body.classList.contains('dark');
      if (isDark) {
        themeIcon.textContent = '☀️';
        localStorage.setItem('theme', 'dark');
        themeSwitch.setAttribute('aria-checked', 'true');
      } else {
        themeIcon.textContent = '🌙';
        localStorage.setItem('theme', 'light');
        themeSwitch.setAttribute('aria-checked', 'false');
      }
    }
    
    // Theme switch keyboard accessibility
    document.getElementById('theme-switch').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleTheme();
      }
    });
    
    // Character counter
    function updateCounter() {
      const textarea = document.getElementById('email-input');
      const counter = document.getElementById('character-count');
      counter.textContent = textarea.value.length;
      updateSubmitState();
    }

    function updateSubmitState() {
      const textarea = document.getElementById('email-input');
      const btn = document.getElementById('analyze-button');
      const text = (textarea.value || '').trim();
      const isEmpty = text.length === 0;
      btn.setAttribute('aria-disabled', String(isEmpty));
      if (!isEmpty) hideButtonAlert();
    }

    function showButtonAlert(message) {
      const pop = document.getElementById('button-popover');
      pop.textContent = message || 'Please enter email content to analyze.';
      pop.style.display = 'block';
      pop.setAttribute('aria-hidden', 'false');
      // Auto-hide after 2.5s
      clearTimeout(window.__popoverTimer);
      window.__popoverTimer = setTimeout(() => {
        hideButtonAlert();
      }, 2500);
    }

    function hideButtonAlert() {
      const pop = document.getElementById('button-popover');
      pop.style.display = 'none';
      pop.setAttribute('aria-hidden', 'true');
    }
    
    // Copy response to clipboard
    function copyResponse() {
      const responseText = document.querySelector('.response-content').textContent;
      navigator.clipboard.writeText(responseText).then(() => {
        const copyButton = document.querySelector('.copy-button');
        const originalText = copyButton.innerHTML;
        
        copyButton.innerHTML = '<span>✓</span> Copied!';
        copyButton.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        copyButton.style.borderColor = 'rgba(16, 185, 129, 0.3)';
        
        setTimeout(() => {
          copyButton.innerHTML = originalText;
          copyButton.style.backgroundColor = '';
          copyButton.style.borderColor = '';
        }, 2000);
      });
    }
    
    // Initialize theme from localStorage
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      const themeIcon = document.getElementById('theme-icon');
      const themeSwitch = document.getElementById('theme-switch');
      
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
        themeIcon.textContent = '☀️';
        themeSwitch.setAttribute('aria-checked', 'true');
      }
      
      // Initialize counter
      updateCounter();

      // Attach validation on submit
      const form = document.getElementById('email-form');
      form.addEventListener('submit', (e) => {
        const textarea = document.getElementById('email-input');
        const text = (textarea.value || '').trim();
        if (text.length === 0) {
          e.preventDefault();
          showButtonAlert('Please enter email content to analyze.');
          textarea.focus();
          return false;
        }
        return true;
      });

      // AI toggle sync (checkbox ↔ aria-checked ↔ hidden input)
      const aiToggle = document.getElementById('enable_ai');
      const aiToggleLabel = document.querySelector('label[for="enable_ai"]');
      const aiHidden = document.getElementById('enable_ai_hidden');
      function syncAiToggle() {
        const checked = aiToggle.checked;
        aiToggleLabel.setAttribute('aria-checked', String(checked));
        aiHidden.value = checked ? 'on' : 'off';
      }
      aiToggle.addEventListener('change', syncAiToggle);
      aiToggleLabel.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          aiToggle.checked = !aiToggle.checked;
          syncAiToggle();
        }
      });
      // initial sync
      syncAiToggle();

      // Apply confidence bar width from data attribute
      document.querySelectorAll('.confidence-bar[data-confidence]')
        .forEach(el => {
          const v = parseFloat(el.getAttribute('data-confidence'));
          if (!isNaN(v)) {
            el.style.setProperty('--confidence', `${v}%`);
          }
        });
    });
  </script>
</body>
</html>